ACCION Ej 2.2.23 (ActualizacionDpec) ES
AMBIENTE
	
	Fecha=registro de
		Año:N(4)
		Mes:N(2)
		Dia:N(2)
	fin registro

	Medidor=registro de
		Casa:N(6)
		UltLectura:Fecha
		CantLectura:N(3)
		PromLectura:N(5)
		Consumidor:{'A','B','C'}
	fin registro
	
	Changes=registro de
		Casa:N(6)
		Medicion:Fecha
		Consumo:N(5)
	fin registro

CLIENTE,ACTUALIZADO:Archivo de Medidor ordenado por Casa
MEDICIONES:Archivo de Changes ordenado por Casa
Mast,NewMast:Medidor
Mov:Changes

ContLecturas;ResgConsumo:Entero

	PROCEDIMIENTO LEER_CLIENTE ES
		LEER(CLIENTE,Mast)
		SI FDA(CLIENTE) ENTONCES
			Mast.Casa:=HV
		FIN SI
	FIN PROCEDIMIENTO
	
	PROCEDIMIENTO LEER_MEDICIONES ES
		LEER(MEDICIONES,Mov)
		SI FDA(MEDICIONES) ENTONCES
			Mov.Casa:=HV
		FIN SI
	FIN PROCEDIMIENTO
	
	PROCEDIMIENTO ActualizarMaestro ES
		NewMast.Casa:=Mast.Casa
	

		SEGUN () HACER
			<20000: NewMast.Consumidor:='A'
			<40000: NewMast.Consumidor:='B'
			>=40000:NewMast.Consumidor:='C'
		Fin SEGUN

	FIN PROCEDIMIENTO		
		
ABRIR E/(CLIENTE,MEDICIONES)
ABRIR S/(ACTUALIZADO)

LEER_CLIENTE
LEER_MEDICIONES


MIENTRAS (Mast.Casa<>HV) o (Mov.Casa<>HV) HACER
	MIENTRAS (Mod.Medicion.Mes<>02) HACER//Esto actualiza hasta el 01/2015		






ACCION 2.2.23 ES
AMBIENTE
	FECHA:REGISTRO
		AÑO:N(4)
		MES:1..12
		DIA:1..31
	FIN REGISTRO
	FORMATO_CLIENTE=REGISTRO
		ID_CASA:N(4)
		FECHA_ULT_LECTURA:FECHA
		CANT_LECTURAS:N(4)
		PROM_LECTURAS:N(10)
		TIPO_CONSUMIDOR:("A","B","C")
	FIN REGISTRO
	FORMATO_MEDICIONES=REGISTRO
		ID_CASA:N(4)
		FECHA_MEDICION:FECHA
		CONSUMO:N(6)
	FIN REGISTRO
	CLIENTE:ARCHIVO DE FORMATO_CLIENTE ORDENADO POR ID_CASA
	SALIDA:ARCHIVO DE FORMATO_CLIENTE ORDENADO POR ID_CASA
	MEDICIONES:ARCHIVO DE FORMATO_MEDICIONES ORDENADO POR ID_CASA
	MAE:FORMATO_CLIENTE
	MOV:FORMATO_MEDICIONES

	PROCEDIMIENTO LEER_CLIENTE ES:
		LEER(CLIENTE, MAE)
		SI FDA(CLIENTE) ENTONCES
			MAE.ID_CASA:=HV
		FIN SI
	FIN PROCEDIMIENTO
	PROCEDIMIENTO LEER_MEDICIONES ES:
		LEER(MEDICIONES, MOV)
		SI FDA(MEDICIONES) ENTONCES
			MOV.ID_CASA:=HV
		FIN SI
	FIN PROCEDIMIENTO
INICIO
	ABRIR/E(CLIENTE)
	ABRIR/E(MEDICIONES)
	ABRIR/S(SALIDA)
	LEER_MEDICIONES
	LEER_CLIENTE
	MIENTRAS (MAE.ID_CASA <> HV) o (MOV.ID_CASA) HACER
		SI (MAE.ID_CASA < MOV.ID_CASA) ENTONCES
			GRABAR(SALIDA,MAE)
			LEER_CLIENTE
		SiNO
			SI (MAE.ID_CASA = MOV.ID_CASA) ENTONCES
				MIENTRAS (MAE.ID_CASA = MOV.ID_CASA) HACER
					SI (MOV.FECHA_MEDICION.AÑO < 2015) O 
						((MOV.FECHA_MEDICION.AÑO = 2015) Y (MOV.FECHA_MEDICION.MES = 1) ENTONCES
						MAE.PRMEDIO := (MAE.CANT_LECTURAS * MAE.PROMEDIO) + MOV.CONSUMO/  MAE.CANT_LECUTRAS + 1
						MAE.CANT_LECUTRAS := MAE.CANT_LECUTRAS + 1
						MAE.FECHA_ULT_LECTURA := MOV.FECHA_MEDICION
					FIN SI
					LEER_MEDICIONES
				FIN MIENTRAS
				SEGUN MAE.PROMEDIO HACER
					<20: MAE.TIPO_CONSUMIDOR:= 'A'
					<40: MAE.TIPO_CONSUMIDOR:= 'B'
					OTRO: MAE.TIPO_CONSUMIDOR:= 'C'
				FIN SEGUN
				GRABAR(SALIDA,MAE)
				LEER_CLIENTE
			SiNO
				MAE.ID_CASA := MOV.ID_CASA
				MAE.FECHA_ULT_LECTURA := MOV.FECHA_MEDICION
				MAE.CANT_LECUTRAS := 1
				MAE.PROMEDIO := MOV.CONSUMO
				LEER_MEDICIONES
				MIENTRAS (MAE.ID_CASA = MOV.ID_CASA) HACER
					SI (MOV.FECHA_MEDICION.AÑO < 2015) O 
						((MOV.FECHA_MEDICION.AÑO = 2015) Y (MOV.FECHA_MEDICION.MES = 1) ENTONCES
						MAE.PRMEDIO := (MAE.CANT_LECTURAS * MAE.PROMEDIO) + MOV.CONSUMO/  MAE.CANT_LECUTRAS + 1
						MAE.CANT_LECUTRAS := MAE.CANT_LECUTRAS + 1
						MAE.FECHA_ULT_LECTURA := MOV.FECHA_MEDICION
					FIN SI
					LEER_MEDICIONES
				FIN MIENTRAS
				SEGUN MAE.PROMEDIO HACER
					<20: MAE.TIPO_CONSUMIDOR:= 'A'
					<40: MAE.TIPO_CONSUMIDOR:= 'B'
					OTRO: MAE.TIPO_CONSUMIDOR:= 'C'
				FIN SEGUN
				GRABAR(SALIDA,MAE)
			FIN SI
		FIN SI
	FIN MIENTRAS

	CERRAR

FIN ACCION
